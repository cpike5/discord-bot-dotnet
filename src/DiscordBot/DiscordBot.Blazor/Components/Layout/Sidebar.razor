@using Microsoft.AspNetCore.Components.Authorization

<aside class="sidebar">
    <!-- Logo -->
    <div class="sidebar-logo">
        <div class="logo-icon">DB</div>
        <div class="logo-text">Discord Bot</div>
    </div>

    <!-- Navigation -->
    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-section-label">Main</div>
            <NavLink href="/" class="nav-item" Match="NavLinkMatch.All">
                <span class="nav-icon">📊</span>
                <span class="nav-label">Dashboard</span>
            </NavLink>
            <NavLink href="/users" class="nav-item">
                <span class="nav-icon">👥</span>
                <span class="nav-label">Users</span>
            </NavLink>
            <NavLink href="/invite-codes" class="nav-item">
                <span class="nav-icon">🎫</span>
                <span class="nav-label">Invite Codes</span>
            </NavLink>
        </div>

        <div class="nav-section">
            <div class="nav-section-label">Bot Management</div>
            <NavLink href="/commands" class="nav-item">
                <span class="nav-icon">🤖</span>
                <span class="nav-label">Commands</span>
            </NavLink>
            <NavLink href="/settings" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span class="nav-label">Settings</span>
            </NavLink>
            <NavLink href="/activity-log" class="nav-item">
                <span class="nav-icon">📝</span>
                <span class="nav-label">Activity Log</span>
            </NavLink>
        </div>

        <div class="nav-section">
            <div class="nav-section-label">System</div>
            <NavLink href="/analytics" class="nav-item">
                <span class="nav-icon">📈</span>
                <span class="nav-label">Analytics</span>
            </NavLink>
        </div>
    </nav>

    <!-- User -->
    <div class="sidebar-user">
        <AuthorizeView>
            <Authorized>
                <div class="user-avatar">@GetUserInitials(context.User.Identity?.Name)</div>
                <div class="user-info">
                    <div class="user-name">@context.User.Identity?.Name</div>
                    <div class="user-role">@GetUserRole(context.User)</div>
                </div>
            </Authorized>
            <NotAuthorized>
                <div class="user-avatar">?</div>
                <div class="user-info">
                    <div class="user-name">Guest</div>
                    <div class="user-role">Not Logged In</div>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</aside>

@code {
    private string GetUserInitials(string? userName)
    {
        if (string.IsNullOrWhiteSpace(userName))
            return "?";

        var parts = userName.Split(new[] { ' ', '@', '.' }, StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();

        return userName.Length >= 2 ? userName.Substring(0, 2).ToUpper() : userName.ToUpper();
    }

    private string GetUserRole(System.Security.Claims.ClaimsPrincipal user)
    {
        if (user.IsInRole("Administrator"))
            return "Administrator";
        if (user.IsInRole("Moderator"))
            return "Moderator";
        return "User";
    }
}
