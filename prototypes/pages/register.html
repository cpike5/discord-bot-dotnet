<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - Discord Bot</title>
  <link rel="stylesheet" href="../css/tokens.css">
  <style>
    /* ============================================
       GLOBAL RESET
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-primary);
    }

    /* ============================================
       PAGE-SPECIFIC STYLES
       ============================================ */

    /* Layout Container */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
      background: linear-gradient(135deg, var(--surface-primary) 0%, var(--color-neutral-800) 100%);
    }

    /* Card Component */
    .auth-card {
      background: var(--card-bg);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-xl);
      padding: var(--space-8);
      width: 100%;
      max-width: 480px;
    }

    /* Header */
    .auth-header {
      text-align: center;
      margin-bottom: var(--space-8);
    }

    .auth-header h1 {
      font-size: var(--text-3xl);
      margin-bottom: var(--space-2);
      color: var(--text-primary);
    }

    .auth-header p {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: var(--space-6);
    }

    .form-label {
      display: block;
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }

    .form-label.required::after {
      content: " *";
      color: var(--color-danger);
    }

    .form-input {
      width: 100%;
      padding: var(--input-padding);
      border: var(--input-border);
      border-radius: var(--input-radius);
      font-size: var(--input-font-size);
      font-family: var(--font-primary);
      background-color: var(--input-bg);
      color: var(--text-primary);
      transition: var(--transition-base);
    }

    .form-input:focus {
      outline: none;
      border: var(--input-border-focus);
    }

    .form-input:disabled {
      background-color: var(--input-bg-disabled);
      color: var(--text-disabled);
      cursor: not-allowed;
    }

    /* Input States */
    .form-input.error {
      border-color: var(--color-danger);
      background-color: rgba(211, 47, 81, 0.05);
    }

    .form-input.error:focus {
      border: 2px solid var(--color-danger);
    }

    .form-input.success {
      border-color: var(--color-success);
      background-color: rgba(135, 179, 141, 0.05);
    }

    .form-input.success:focus {
      border: 2px solid var(--color-success);
    }

    /* Helper Text */
    .helper-text {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-top: var(--space-2);
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .helper-text::before {
      content: "ℹ";
      font-size: var(--text-base);
    }

    /* Error Message */
    .error-message {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-top: var(--space-2);
      font-size: var(--text-sm);
      color: var(--color-danger);
    }

    .error-message::before {
      content: "⚠";
      font-size: var(--text-base);
    }

    /* Success Message */
    .success-message {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-top: var(--space-2);
      font-size: var(--text-sm);
      color: var(--color-success);
    }

    .success-message::before {
      content: "✓";
      font-size: var(--text-base);
      font-weight: var(--font-bold);
    }

    /* Validation Indicator */
    .validation-indicator {
      position: absolute;
      right: var(--space-3);
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--text-lg);
      pointer-events: none;
    }

    .input-wrapper {
      position: relative;
    }

    /* Alert Box */
    .alert {
      padding: var(--space-4);
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-6);
      font-size: var(--text-sm);
    }

    .alert.error {
      background-color: rgba(211, 47, 81, 0.1);
      border: 1px solid var(--color-danger);
      color: var(--color-danger);
    }

    .alert.success {
      background-color: rgba(135, 179, 141, 0.1);
      border: 1px solid var(--color-success);
      color: var(--color-success);
    }

    .alert.info {
      background-color: rgba(211, 196, 227, 0.2);
      border: 1px solid var(--color-info);
      color: var(--color-slate);
    }

    /* Password Requirements List */
    .password-requirements {
      margin-top: var(--space-3);
      padding: var(--space-3);
      background-color: var(--color-neutral-50);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
    }

    .password-requirements p {
      font-weight: var(--font-medium);
      margin-bottom: var(--space-2);
      color: var(--text-primary);
    }

    .password-requirements ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .password-requirements li {
      padding: var(--space-1) 0;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .password-requirements li::before {
      content: "○";
      color: var(--color-neutral-400);
    }

    .password-requirements li.valid {
      color: var(--color-success);
    }

    .password-requirements li.valid::before {
      content: "✓";
      color: var(--color-success);
      font-weight: var(--font-bold);
    }

    .password-requirements li.invalid {
      color: var(--color-danger);
    }

    .password-requirements li.invalid::before {
      content: "✗";
      color: var(--color-danger);
    }

    /* Button Component */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--btn-padding-md);
      border-radius: var(--btn-border-radius);
      font-size: var(--text-base);
      font-weight: var(--btn-font-weight);
      font-family: var(--font-primary);
      text-align: center;
      cursor: pointer;
      transition: var(--btn-transition);
      border: none;
      text-decoration: none;
      width: 100%;
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: var(--text-on-primary);
    }

    .btn-primary:hover {
      background-color: var(--color-primary-hover);
    }

    .btn-primary:active {
      background-color: var(--color-primary-active);
    }

    .btn-primary:disabled {
      background-color: var(--color-neutral-300);
      color: var(--text-disabled);
      cursor: not-allowed;
    }

    /* Utility Links */
    .form-footer {
      text-align: center;
      margin-top: var(--space-6);
      padding-top: var(--space-6);
      border-top: 1px solid var(--border-light);
    }

    .form-footer p {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .form-footer a {
      color: var(--color-primary);
      font-weight: var(--font-medium);
    }

    .form-footer a:hover {
      color: var(--color-primary-hover);
      text-decoration: underline;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .auth-card {
        padding: var(--space-6);
      }

      .auth-header h1 {
        font-size: var(--text-2xl);
      }
    }

    /* Demo States Toggle */
    .demo-toggle {
      position: fixed;
      top: var(--space-4);
      right: var(--space-4);
      background: var(--surface-card);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      font-size: var(--text-sm);
      z-index: var(--z-sticky);
    }

    .demo-toggle label {
      font-weight: var(--font-medium);
      margin-right: var(--space-2);
    }

    .demo-toggle select {
      padding: var(--space-2);
      border: var(--input-border);
      border-radius: var(--radius-sm);
      font-family: var(--font-primary);
    }
  </style>
</head>
<body>
  <!-- Demo State Toggle (for prototype only) -->
  <div class="demo-toggle">
    <label for="state-selector">Demo State:</label>
    <select id="state-selector" onchange="changeState(this.value)">
      <option value="clean">Clean State</option>
      <option value="validating">Validating (Real-time)</option>
      <option value="error-invalid-code">Error: Invalid Code</option>
      <option value="error-expired-code">Error: Expired Code</option>
      <option value="error-validation">Error: Validation Errors</option>
      <option value="success">Success State</option>
    </select>
  </div>

  <!-- Main Authentication Container -->
  <div class="auth-container">
    <div class="auth-card">

      <!-- Header -->
      <header class="auth-header">
        <h1>Create Account</h1>
        <p>Link your Discord account to get started</p>
      </header>

      <!-- Success Alert (hidden by default) -->
      <div id="success-alert" class="alert success" style="display: none;">
        <strong>Registration successful!</strong> Your Discord account has been linked. You can now log in.
      </div>

      <!-- Error Alert (hidden by default) -->
      <div id="error-alert" class="alert error" style="display: none;">
        <strong id="error-title">Registration failed</strong>
        <p id="error-message" style="margin-top: var(--space-2);">Please correct the errors below and try again.</p>
      </div>

      <!-- Registration Form -->
      <form id="register-form" action="/Account/Register" method="POST" novalidate>

        <!-- Invite Code Field (at top per requirements) -->
        <div class="form-group">
          <label for="invite-code" class="form-label required">Invite Code</label>
          <div class="input-wrapper">
            <input
              type="text"
              id="invite-code"
              name="inviteCode"
              class="form-input"
              placeholder="XXXX-XXXX-XXXX"
              required
              maxlength="14"
              pattern="[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}"
              autocomplete="off"
            >
            <span id="invite-code-indicator" class="validation-indicator" style="display: none;"></span>
          </div>
          <div id="invite-code-helper" class="helper-text">
            Get your code from Discord using <strong>/register</strong>
          </div>
          <div id="invite-code-error" class="error-message" style="display: none;">
            Invalid invite code format.
          </div>
          <div id="invite-code-success" class="success-message" style="display: none;">
            Valid invite code.
          </div>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label for="email" class="form-label required">Email</label>
          <div class="input-wrapper">
            <input
              type="email"
              id="email"
              name="email"
              class="form-input"
              placeholder="you@example.com"
              required
              autocomplete="email"
            >
            <span id="email-indicator" class="validation-indicator" style="display: none;"></span>
          </div>
          <div id="email-error" class="error-message" style="display: none;">
            Please enter a valid email address.
          </div>
          <div id="email-success" class="success-message" style="display: none;">
            Valid email address.
          </div>
        </div>

        <!-- Password Field -->
        <div class="form-group">
          <label for="password" class="form-label required">Password</label>
          <div class="input-wrapper">
            <input
              type="password"
              id="password"
              name="password"
              class="form-input"
              placeholder="Create a strong password"
              required
              autocomplete="new-password"
            >
            <span id="password-indicator" class="validation-indicator" style="display: none;"></span>
          </div>

          <!-- Password Requirements (shown on focus) -->
          <div id="password-requirements" class="password-requirements" style="display: none;">
            <p>Password must contain:</p>
            <ul>
              <li id="req-length">At least 6 characters</li>
              <li id="req-uppercase">One uppercase letter</li>
              <li id="req-lowercase">One lowercase letter</li>
              <li id="req-number">One number</li>
            </ul>
          </div>

          <div id="password-error" class="error-message" style="display: none;">
            Password does not meet requirements.
          </div>
          <div id="password-success" class="success-message" style="display: none;">
            Strong password.
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirm-password" class="form-label required">Confirm Password</label>
          <div class="input-wrapper">
            <input
              type="password"
              id="confirm-password"
              name="confirmPassword"
              class="form-input"
              placeholder="Re-enter your password"
              required
              autocomplete="new-password"
            >
            <span id="confirm-password-indicator" class="validation-indicator" style="display: none;"></span>
          </div>
          <div id="confirm-password-error" class="error-message" style="display: none;">
            Passwords do not match.
          </div>
          <div id="confirm-password-success" class="success-message" style="display: none;">
            Passwords match.
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">
          Create Account
        </button>
      </form>

      <!-- Footer Links -->
      <div class="form-footer">
        <p>Already have an account? <a href="login.html">Sign in here</a></p>
      </div>

    </div>
  </div>

  <!-- JavaScript for Validation and Demo States -->
  <script>
    /**
     * Form Validation and Real-time Feedback
     * Implements the validation rules from functional specs
     */

    // Password validation requirements
    const passwordRules = {
      length: (pwd) => pwd.length >= 6,
      uppercase: (pwd) => /[A-Z]/.test(pwd),
      lowercase: (pwd) => /[a-z]/.test(pwd),
      number: (pwd) => /[0-9]/.test(pwd)
    };

    // Invite code format validation
    function validateInviteCodeFormat(code) {
      const pattern = /^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
      return pattern.test(code);
    }

    // Email validation
    function validateEmail(email) {
      const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return pattern.test(email);
    }

    // Update validation UI for a field
    function updateFieldValidation(fieldId, isValid, errorMsg, successMsg) {
      const field = document.getElementById(fieldId);
      const errorEl = document.getElementById(`${fieldId}-error`);
      const successEl = document.getElementById(`${fieldId}-success`);
      const indicator = document.getElementById(`${fieldId}-indicator`);

      // Remove all states first
      field.classList.remove('error', 'success');
      errorEl.style.display = 'none';
      successEl.style.display = 'none';
      indicator.style.display = 'none';

      if (field.value === '') {
        return; // Don't show validation for empty fields
      }

      if (isValid) {
        field.classList.add('success');
        successEl.style.display = 'block';
        if (successMsg) successEl.textContent = successMsg;
        indicator.textContent = '✓';
        indicator.style.color = 'var(--color-success)';
        indicator.style.display = 'block';
      } else {
        field.classList.add('error');
        errorEl.style.display = 'block';
        if (errorMsg) errorEl.textContent = errorMsg;
        indicator.textContent = '✗';
        indicator.style.color = 'var(--color-danger)';
        indicator.style.display = 'block';
      }
    }

    // Invite Code Validation
    document.getElementById('invite-code').addEventListener('input', function(e) {
      // Auto-format: Convert to uppercase and add dashes
      let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      if (value.length > 4) {
        value = value.slice(0, 4) + '-' + value.slice(4);
      }
      if (value.length > 9) {
        value = value.slice(0, 9) + '-' + value.slice(9);
      }
      e.target.value = value.slice(0, 14);
    });

    document.getElementById('invite-code').addEventListener('blur', function() {
      const code = this.value;
      if (code === '') return;

      const isValid = validateInviteCodeFormat(code);
      updateFieldValidation(
        'invite-code',
        isValid,
        'Invalid invite code format. Expected: XXXX-XXXX-XXXX',
        'Valid format. Code will be verified on submit.'
      );
    });

    // Email Validation
    document.getElementById('email').addEventListener('blur', function() {
      const email = this.value;
      if (email === '') return;

      const isValid = validateEmail(email);
      updateFieldValidation(
        'email',
        isValid,
        'Please enter a valid email address.',
        'Valid email address.'
      );
    });

    // Password Validation with Requirements Display
    const passwordField = document.getElementById('password');
    const passwordReqs = document.getElementById('password-requirements');

    passwordField.addEventListener('focus', function() {
      passwordReqs.style.display = 'block';
    });

    passwordField.addEventListener('input', function() {
      const pwd = this.value;

      // Update each requirement
      const lengthValid = passwordRules.length(pwd);
      const uppercaseValid = passwordRules.uppercase(pwd);
      const lowercaseValid = passwordRules.lowercase(pwd);
      const numberValid = passwordRules.number(pwd);

      document.getElementById('req-length').className = pwd ? (lengthValid ? 'valid' : 'invalid') : '';
      document.getElementById('req-uppercase').className = pwd ? (uppercaseValid ? 'valid' : 'invalid') : '';
      document.getElementById('req-lowercase').className = pwd ? (lowercaseValid ? 'valid' : 'invalid') : '';
      document.getElementById('req-number').className = pwd ? (numberValid ? 'valid' : 'invalid') : '';
    });

    passwordField.addEventListener('blur', function() {
      const pwd = this.value;
      if (pwd === '') {
        passwordReqs.style.display = 'none';
        return;
      }

      const allValid = Object.values(passwordRules).every(rule => rule(pwd));
      updateFieldValidation(
        'password',
        allValid,
        'Password does not meet all requirements.',
        'Strong password.'
      );
    });

    // Confirm Password Validation
    document.getElementById('confirm-password').addEventListener('blur', function() {
      const pwd = document.getElementById('password').value;
      const confirmPwd = this.value;

      if (confirmPwd === '') return;

      const matches = pwd === confirmPwd;
      updateFieldValidation(
        'confirm-password',
        matches,
        'Passwords do not match.',
        'Passwords match.'
      );
    });

    // Also revalidate confirm password when main password changes
    document.getElementById('password').addEventListener('input', function() {
      const confirmPwd = document.getElementById('confirm-password').value;
      if (confirmPwd !== '') {
        const matches = this.value === confirmPwd;
        updateFieldValidation(
          'confirm-password',
          matches,
          'Passwords do not match.',
          'Passwords match.'
        );
      }
    });

    // Form Submission
    document.getElementById('register-form').addEventListener('submit', function(e) {
      e.preventDefault();

      // Validate all fields
      const inviteCode = document.getElementById('invite-code').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      let hasError = false;

      // Validate invite code
      if (!validateInviteCodeFormat(inviteCode)) {
        updateFieldValidation('invite-code', false, 'Invalid invite code format.');
        hasError = true;
      }

      // Validate email
      if (!validateEmail(email)) {
        updateFieldValidation('email', false, 'Please enter a valid email address.');
        hasError = true;
      }

      // Validate password
      const allPasswordRulesValid = Object.values(passwordRules).every(rule => rule(password));
      if (!allPasswordRulesValid) {
        updateFieldValidation('password', false, 'Password does not meet requirements.');
        hasError = true;
      }

      // Validate passwords match
      if (password !== confirmPassword) {
        updateFieldValidation('confirm-password', false, 'Passwords do not match.');
        hasError = true;
      }

      // Show error or submit
      if (hasError) {
        document.getElementById('error-alert').style.display = 'block';
        document.getElementById('error-title').textContent = 'Registration failed';
        document.getElementById('error-message').textContent = 'Please correct the errors below and try again.';
        window.scrollTo(0, 0);
      } else {
        // In production, this would submit to server
        alert('Form is valid and would submit to server');
      }
    });

    /**
     * Demo State Management
     * For prototype demonstration purposes
     */
    function changeState(state) {
      // Reset everything first
      document.getElementById('register-form').reset();
      document.querySelectorAll('.form-input').forEach(input => {
        input.classList.remove('error', 'success');
      });
      document.querySelectorAll('.error-message, .success-message, .validation-indicator').forEach(el => {
        el.style.display = 'none';
      });
      document.getElementById('error-alert').style.display = 'none';
      document.getElementById('success-alert').style.display = 'none';
      document.getElementById('password-requirements').style.display = 'none';

      // Apply selected state
      switch(state) {
        case 'clean':
          // Clean state - already reset above
          break;

        case 'validating':
          // Show real-time validation with partial data
          document.getElementById('invite-code').value = 'A1B2-C3D4-E5F6';
          document.getElementById('email').value = 'user@example.com';
          document.getElementById('password').value = 'SecurePass123';
          document.getElementById('confirm-password').value = 'SecurePass123';

          // Trigger validation
          updateFieldValidation('invite-code', true, '', 'Valid format. Code will be verified on submit.');
          updateFieldValidation('email', true, '', 'Valid email address.');
          updateFieldValidation('password', true, '', 'Strong password.');
          updateFieldValidation('confirm-password', true, '', 'Passwords match.');
          break;

        case 'error-invalid-code':
          document.getElementById('invite-code').value = 'INVALID123';
          document.getElementById('email').value = 'user@example.com';
          updateFieldValidation('invite-code', false, 'Invalid invite code format. Expected: XXXX-XXXX-XXXX');
          document.getElementById('error-alert').style.display = 'block';
          document.getElementById('error-title').textContent = 'Invalid invite code';
          document.getElementById('error-message').textContent = 'The invite code format is invalid. Please check your code from Discord.';
          break;

        case 'error-expired-code':
          document.getElementById('invite-code').value = 'X7K9-M2P4-Q8N6';
          document.getElementById('email').value = 'user@example.com';
          updateFieldValidation('invite-code', false, 'This invite code has expired. Please return to Discord and use the /register command to get a new code.');
          document.getElementById('error-alert').style.display = 'block';
          document.getElementById('error-title').textContent = 'Invite code expired';
          document.getElementById('error-message').textContent = 'This invite code has expired. Please return to Discord and use the /register command to get a new code.';
          break;

        case 'error-validation':
          document.getElementById('invite-code').value = 'BAD-FORMAT';
          document.getElementById('email').value = 'invalid-email';
          document.getElementById('password').value = 'weak';
          document.getElementById('confirm-password').value = 'different';

          updateFieldValidation('invite-code', false, 'Invalid invite code format.');
          updateFieldValidation('email', false, 'Please enter a valid email address.');
          updateFieldValidation('password', false, 'Password does not meet requirements.');
          updateFieldValidation('confirm-password', false, 'Passwords do not match.');

          document.getElementById('error-alert').style.display = 'block';
          document.getElementById('error-title').textContent = 'Registration failed';
          document.getElementById('error-message').textContent = 'Please correct the errors below and try again.';
          break;

        case 'success':
          document.getElementById('success-alert').style.display = 'block';
          break;
      }
    }
  </script>
</body>
</html>
